(function(t){function e(e){for(var s,o,n=e[0],l=e[1],c=e[2],u=0,m=[];u<n.length;u++)o=n[u],Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&m.push(r[o][0]),r[o]=0;for(s in l)Object.prototype.hasOwnProperty.call(l,s)&&(t[s]=l[s]);d&&d(e);while(m.length)m.shift()();return i.push.apply(i,c||[]),a()}function a(){for(var t,e=0;e<i.length;e++){for(var a=i[e],s=!0,n=1;n<a.length;n++){var l=a[n];0!==r[l]&&(s=!1)}s&&(i.splice(e--,1),t=o(o.s=a[0]))}return t}var s={},r={app:0},i=[];function o(e){if(s[e])return s[e].exports;var a=s[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,o),a.l=!0,a.exports}o.m=t,o.c=s,o.d=function(t,e,a){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(o.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)o.d(a,s,function(e){return t[e]}.bind(null,s));return a},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/";var n=window["webpackJsonp"]=window["webpackJsonp"]||[],l=n.push.bind(n);n.push=e,n=n.slice();for(var c=0;c<n.length;c++)e(n[c]);var d=l;i.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},"076f":function(t,e,a){},"08be":function(t,e,a){},"08e9":function(t,e,a){},"1c92":function(t,e,a){},"21c0":function(t,e,a){"use strict";a("ac4b")},"22fc":function(t,e,a){"use strict";a("08be")},"2cd6":function(t,e,a){},4638:function(t,e,a){"use strict";a("1c92")},"56d7":function(t,e,a){"use strict";a.r(e);var s=a("2b0e"),r=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"app"}},[e("header",[e("b-navbar",{attrs:{toggleable:"lg",type:"dark",variant:"info"}},[e("b-container",[e("b-navbar-brand",{attrs:{to:"/"}},[t._v("Telegram收藏夹")]),e("b-navbar-toggle",{attrs:{target:"nav-collapse"}}),e("b-collapse",{attrs:{id:"nav-collapse","is-nav":""}},[e("b-navbar-nav",[e("b-nav-item",{attrs:{to:"/",exact:""}},[t._v("首页")]),e("b-nav-item",{attrs:{to:"/favorites"}},[t._v("收藏内容")]),e("b-nav-item",{attrs:{to:"/tags"}},[t._v("标签管理")])],1),e("b-navbar-nav",{staticClass:"ml-auto"},[e("b-nav-form",{staticClass:"d-flex my-2 my-lg-0"},[e("b-form-input",{staticClass:"mr-sm-2",attrs:{size:"sm",placeholder:"搜索收藏..."},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onSearch.apply(null,arguments)}},model:{value:t.searchQuery,callback:function(e){t.searchQuery=e},expression:"searchQuery"}}),e("b-button",{staticClass:"my-2 my-sm-0",attrs:{size:"sm",type:"submit",variant:"outline-light"},on:{click:function(e){return e.preventDefault(),t.onSearch.apply(null,arguments)}}},[e("i",{staticClass:"bi bi-search"})])],1),t.isLoggedIn?e("b-nav-item-dropdown",{attrs:{right:""},scopedSlots:t._u([{key:"button-content",fn:function(){return[e("em",{staticClass:"text-white"},[t._v(t._s(t.username))])]},proxy:!0}],null,!1,3043702746)},[e("b-dropdown-item",{attrs:{to:"/settings"}},[t._v("设置")]),e("b-dropdown-item",{on:{click:t.confirmLogout}},[t._v("退出登录")])],1):e("b-nav-item",{attrs:{to:"/login"}},[t._v("登录")])],1)],1)],1)],1)],1),e("main",{staticClass:"container mt-4 flex-grow-1"},[e("router-view")],1),e("footer",{staticClass:"footer mt-5 py-3 bg-light text-center"},[e("b-container",[e("span",{staticClass:"text-muted"},[t._v("Telegram收藏夹查看系统 © "+t._s((new Date).getFullYear()))])])],1),e("b-modal",{attrs:{id:"logout-modal",title:"确认退出","ok-variant":"danger","ok-title":"退出"},on:{ok:t.logout}},[e("p",[t._v("确定要退出登录吗？")])])],1)},i=[],o=a("2f62"),n={name:"App",data(){return{searchQuery:""}},computed:{...Object(o["c"])("auth",["isLoggedIn","username"])},methods:{...Object(o["b"])("auth",["logout"]),onSearch(){this.searchQuery.trim()&&(this.$router.push({path:"/search",query:{q:this.searchQuery.trim()}}).catch(()=>{}),this.searchQuery="")},confirmLogout(){this.$bvModal.show("logout-modal")}},created(){!this.isLoggedIn&&localStorage.getItem("token")&&this.$store.dispatch("auth/initializeAuth")}},l=n,c=(a("21c0"),a("2877")),d=Object(c["a"])(l,r,i,!1,null,null,null),u=d.exports,m=a("8c4f"),g=a("bc3a"),p=a.n(g);const h=p.a.create({baseURL:"/api",headers:{"Content-Type":"application/json"}});h.interceptors.request.use(t=>{const e=k.state.auth.token;return e&&(t.headers.Authorization="Bearer "+e),t},t=>Promise.reject(t)),h.interceptors.response.use(t=>t,t=>(t.response&&401===t.response.status&&k.dispatch("auth/logout"),Promise.reject(t)));var v=h;const b={token:localStorage.getItem("token")||null,user:null,accounts:[],activeAccount:null,loading:!1,error:null,sessionStatus:"idle",sessionError:null,syncLoading:!1,lastSyncTime:null},f={isAuthenticated:t=>!!t.token,currentUser:t=>t.user,username:t=>t.user?t.user.username:"",telegramAccounts:t=>t.accounts,activeAccount:t=>t.activeAccount,hasActiveAccount:t=>!!t.activeAccount,isLoading:t=>t.loading,hasError:t=>!!t.error,errorMessage:t=>t.error,sessionStatus:t=>t.sessionStatus,sessionError:t=>t.sessionError,syncLoading:t=>t.syncLoading,lastSyncTime:t=>t.lastSyncTime},_={SET_TOKEN(t,e){t.token=e},SET_USER(t,e){t.user=e,e&&e.accounts&&(t.accounts=e.accounts,t.activeAccount=e.accounts.find(t=>t.isActive)||null)},SET_ACCOUNTS(t,e){t.accounts=e},SET_ACTIVE_ACCOUNT(t,e){t.activeAccount=e},ADD_ACCOUNT(t,e){t.accounts.push(e)},UPDATE_ACCOUNT(t,e){const a=t.accounts.findIndex(t=>t.id===e.id);-1!==a&&t.accounts.splice(a,1,{...e,isActive:t.accounts[a].isActive}),t.activeAccount&&t.activeAccount.id===e.id&&(t.activeAccount={...t.activeAccount,...e})},REMOVE_ACCOUNT(t,e){t.accounts=t.accounts.filter(t=>t.id!==e),t.activeAccount&&t.activeAccount.id===e&&(t.activeAccount=t.accounts[0]||null,t.activeAccount&&(t.activeAccount.isActive=!0))},SET_LOADING(t,e){t.loading=e},SET_ERROR(t,e){t.error=e},LOGOUT(t){t.token=null,t.user=null,t.accounts=[],t.activeAccount=null,t.loading=!1,t.error=null,t.sessionStatus="idle",t.sessionError=null,t.syncLoading=!1,t.lastSyncTime=null},SET_SESSION_STATUS(t,e){t.sessionStatus=e},SET_SESSION_ERROR(t,e){t.sessionError=e},SET_SYNC_LOADING(t,e){t.syncLoading=e},SET_LAST_SYNC_TIME(t,e){t.lastSyncTime=e}},y={async initializeAuth({commit:t,dispatch:e,state:a}){if(a.token&&!a.user)try{await e("fetchCurrentUser")}catch(s){console.error("初始化认证失败，token 可能无效:",s),e("logout")}},async register({commit:t},e){t("SET_LOADING",!0),t("SET_ERROR",null);try{const a=await v.post("/auth/register",e);return t("SET_LOADING",!1),a.data}catch(a){let e="注册失败";throw a.response&&a.response.data&&a.response.data.message&&(e=a.response.data.message),t("SET_ERROR",e),t("SET_LOADING",!1),a}},async login({commit:t,dispatch:e},a){t("SET_LOADING",!0),t("SET_ERROR",null);try{const e=await v.post("/auth/login",a),{token:s,user:r}=e.data;return localStorage.setItem("token",s),t("SET_TOKEN",s),t("SET_USER",r),t("SET_LOADING",!1),e.data}catch(s){let e="登录失败";throw s.response&&s.response.data&&s.response.data.message&&(e=s.response.data.message),t("SET_ERROR",e),t("SET_LOADING",!1),s}},async fetchCurrentUser({commit:t,state:e}){if(!e.token)throw new Error("未认证用户");t("SET_LOADING",!0),t("SET_ERROR",null);try{const e=await v.get("/auth/me"),a=e.data;return t("SET_USER",a),t("SET_LOADING",!1),a}catch(a){let e="获取用户信息失败";throw a.response&&a.response.data&&a.response.data.message&&(e=a.response.data.message),t("SET_ERROR",e),t("SET_LOADING",!1),a}},async addTelegramAccount({commit:t},e){t("SET_LOADING",!0),t("SET_ERROR",null);try{const a=await v.post("/user/accounts",e),s=a.data;return t("ADD_ACCOUNT",s),s.isActive&&t("SET_ACTIVE_ACCOUNT",s),t("SET_LOADING",!1),s}catch(a){let e="添加Telegram账号失败";throw a.response&&a.response.data&&a.response.data.message&&(e=a.response.data.message),t("SET_ERROR",e),t("SET_LOADING",!1),a}},async switchTelegramAccount({commit:t},e){t("SET_LOADING",!0),t("SET_ERROR",null);try{const a=await v.post(`/user/accounts/${e}/activate`),{token:s,account:r}=a.data;return localStorage.setItem("token",s),t("SET_TOKEN",s),t("SET_ACCOUNTS",b.accounts.map(t=>({...t,isActive:t.id===e}))),t("SET_ACTIVE_ACCOUNT",r),t("SET_LOADING",!1),r}catch(a){let e="切换Telegram账号失败";throw a.response&&a.response.data&&a.response.data.message&&(e=a.response.data.message),t("SET_ERROR",e),t("SET_LOADING",!1),a}},async updateTelegramAccount({commit:t},{accountId:e,updateData:a}){t("SET_LOADING",!0),t("SET_ERROR",null);try{const s=await v.put("/user/accounts/"+e,a),r=s.data;return t("UPDATE_ACCOUNT",r),b.activeAccount&&b.activeAccount.id===r.id&&t("SET_ACTIVE_ACCOUNT",{...b.activeAccount,...r}),t("SET_LOADING",!1),r}catch(s){let e="更新Telegram账号失败";throw s.response&&s.response.data&&s.response.data.message&&(e=s.response.data.message),t("SET_ERROR",e),t("SET_LOADING",!1),s}},async deleteTelegramAccount({commit:t},e){t("SET_LOADING",!0),t("SET_ERROR",null);try{const a=await v.delete("/user/accounts/"+e),{token:s,remainingAccounts:r}=a.data;return t("REMOVE_ACCOUNT",e),s&&(localStorage.setItem("token",s),t("SET_TOKEN",s)),r&&(t("SET_ACCOUNTS",r),t("SET_ACTIVE_ACCOUNT",r.find(t=>t.isActive)||null)),t("SET_LOADING",!1),a.data}catch(a){let e="删除Telegram账号失败";throw a.response&&a.response.data&&a.response.data.message&&(e=a.response.data.message),t("SET_ERROR",e),t("SET_LOADING",!1),a}},clearError({commit:t}){t("SET_ERROR",null)},logout({commit:t}){localStorage.removeItem("token"),t("LOGOUT"),xt.push("/login")},async syncFavorites({commit:t}){t("SET_SYNC_LOADING",!0),t("SET_SESSION_ERROR",null);try{const e=await v.post("/user/sync");return t("SET_LAST_SYNC_TIME",(new Date).toISOString()),t("SET_SYNC_LOADING",!1),e.data}catch(e){let a="同步收藏失败";throw e.response&&e.response.data&&e.response.data.message&&(a=e.response.data.message),t("SET_SESSION_ERROR",a),t("SET_SYNC_LOADING",!1),e}},async updateUserSettings({commit:t},e){t("SET_LOADING",!0),t("SET_ERROR",null);try{const a=await v.put("/user/settings",e),s=a.data;return t("SET_USER",{...b.user,settings:s}),t("SET_LOADING",!1),s}catch(a){let e="更新设置失败";throw a.response&&a.response.data&&a.response.data.message&&(e=a.response.data.message),t("SET_ERROR",e),t("SET_LOADING",!1),a}}};var T={namespaced:!0,state:b,getters:f,actions:y,mutations:_};const S={favorites:[],favorite:null,loading:!1,error:null,filters:{tags:[],type:null,category:null,search:null,sortBy:"savedAt",sortOrder:"desc"},pagination:{page:1,limit:20,total:0,totalPages:0}},A={allFavorites:t=>t.favorites,currentFavorite:t=>t.favorite,isLoading:t=>t.loading,hasError:t=>!!t.error,errorMessage:t=>t.error,currentFilters:t=>t.filters,currentPagination:t=>t.pagination},E={SET_FAVORITES(t,e){t.favorites=e},SET_FAVORITE(t,e){t.favorite=e},SET_LOADING(t,e){t.loading=e},SET_ERROR(t,e){t.error=e},SET_FILTERS(t,e){t.filters={...t.filters,...e}},SET_PAGINATION(t,e){t.pagination={...t.pagination,...e}},CLEAR_FILTERS(t){t.filters={tags:[],type:null,search:null,category:null,sortBy:"savedAt",sortOrder:"desc"}},ADD_FAVORITE(t,e){t.favorites.unshift(e),t.pagination.total++},UPDATE_FAVORITE(t,e){const a=t.favorites.findIndex(t=>t._id===e._id);-1!==a&&t.favorites.splice(a,1,e),t.favorite&&t.favorite._id===e._id&&(t.favorite=e)},REMOVE_FAVORITE(t,e){t.favorites=t.favorites.filter(t=>t._id!==e),t.pagination.total--,t.favorite&&t.favorite._id===e&&(t.favorite=null)}},C={async fetchFavorites({commit:t,state:e,rootGetters:a}){t("SET_LOADING",!0),t("SET_ERROR",null);try{const a={page:e.pagination.page,limit:e.pagination.limit,sortBy:e.filters.sortBy,sortOrder:e.filters.sortOrder};e.filters.tags&&e.filters.tags.length>0&&(a.tags=e.filters.tags.join(",")),e.filters.type&&(a.type=e.filters.type),e.filters.category&&(a.category=e.filters.category),e.filters.search&&(a.search=e.filters.search);const s=await v.get("/favorites",{params:a}),{favorites:r,pagination:i}=s.data;t("SET_FAVORITES",r),t("SET_PAGINATION",{total:i.total,page:i.page,limit:i.limit,totalPages:i.totalPages}),t("SET_LOADING",!1)}catch(s){let e="获取收藏列表失败";throw s.response&&s.response.data&&s.response.data.message&&(e=s.response.data.message),t("SET_ERROR",e),t("SET_LOADING",!1),s}},async fetchFavoriteById({commit:t},e){t("SET_LOADING",!0),t("SET_ERROR",null);try{const a=await v.get("/favorites/"+e);return t("SET_FAVORITE",a.data),t("SET_LOADING",!1),a.data}catch(a){let e="获取收藏详情失败";throw a.response&&a.response.data&&a.response.data.message&&(e=a.response.data.message),t("SET_ERROR",e),t("SET_LOADING",!1),a}},async updateFavoriteTags({commit:t},{favoriteId:e,tags:a}){t("SET_LOADING",!0),t("SET_ERROR",null);try{const s=await v.post(`/favorites/${e}/tags`,{tags:a});return t("UPDATE_FAVORITE",s.data),t("SET_LOADING",!1),s.data}catch(s){let e="更新收藏标签失败";throw s.response&&s.response.data&&s.response.data.message&&(e=s.response.data.message),t("SET_ERROR",e),t("SET_LOADING",!1),s}},async removeTagFromFavorite({commit:t},{favoriteId:e,tagName:a}){t("SET_LOADING",!0),t("SET_ERROR",null);try{const s=await v.delete(`/favorites/${e}/tags/${a}`);return t("UPDATE_FAVORITE",s.data),t("SET_LOADING",!1),s.data}catch(s){let e="移除标签失败";throw s.response&&s.response.data&&s.response.data.message&&(e=s.response.data.message),t("SET_ERROR",e),t("SET_LOADING",!1),s}},async deleteFavorite({commit:t,dispatch:e},a){t("SET_LOADING",!0),t("SET_ERROR",null);try{await v.delete("/favorites/"+a),t("REMOVE_FAVORITE",a),t("SET_LOADING",!1),0===S.favorites.length&&S.pagination.page>1?(t("SET_PAGINATION",{page:S.pagination.page-1}),e("fetchFavorites")):e("fetchFavorites")}catch(s){let e="删除收藏失败";throw s.response&&s.response.data&&s.response.data.message&&(e=s.response.data.message),t("SET_ERROR",e),t("SET_LOADING",!1),s}},updateFiltersAndFetch({commit:t,dispatch:e},a){t("SET_FILTERS",a),t("SET_PAGINATION",{page:1}),e("fetchFavorites")},clearAllFilters({commit:t,dispatch:e}){t("CLEAR_FILTERS"),t("SET_PAGINATION",{page:1}),e("fetchFavorites")},setPage({commit:t,dispatch:e},a){t("SET_PAGINATION",{page:a}),e("fetchFavorites")}};var w={namespaced:!0,state:S,getters:A,actions:C,mutations:E};const O={tags:[],loading:!1,error:null},I={allTags:t=>t.tags,isLoading:t=>t.loading,hasError:t=>!!t.error,errorMessage:t=>t.error},x={SET_TAGS(t,e){t.tags=e},SET_LOADING(t,e){t.loading=e},SET_ERROR(t,e){t.error=e},ADD_TAG(t,e){const a=t.tags.findIndex(t=>t._id===e._id);-1!==a?t.tags.splice(a,1,e):t.tags.push(e)},UPDATE_TAG(t,e){const a=t.tags.findIndex(t=>t._id===e._id);-1!==a&&t.tags.splice(a,1,e)},REMOVE_TAG(t,e){t.tags=t.tags.filter(t=>t._id!==e)}},F={async fetchTags({commit:t}){t("SET_LOADING",!0),t("SET_ERROR",null);try{const e=await v.get("/tags");t("SET_TAGS",e.data),t("SET_LOADING",!1)}catch(e){let a="获取标签失败";throw e.response&&e.response.data&&e.response.data.message&&(a=e.response.data.message),t("SET_ERROR",a),t("SET_LOADING",!1),e}},async createTag({commit:t,dispatch:e},a){t("SET_LOADING",!0),t("SET_ERROR",null);try{const e=await v.post("/tags",a);return t("ADD_TAG",e.data),t("SET_LOADING",!1),e.data}catch(s){let e="创建标签失败";throw s.response&&400===s.response.status&&s.response.data&&"用户名已存在"===s.response.data.message?e="标签名称已存在":s.response&&s.response.data&&s.response.data.message&&(e=s.response.data.message),t("SET_ERROR",e),t("SET_LOADING",!1),s}},async updateTag({commit:t},{id:e,tagData:a}){t("SET_LOADING",!0),t("SET_ERROR",null);try{const s=await v.put("/tags/"+e,a);return t("UPDATE_TAG",s.data),t("SET_LOADING",!1),s.data}catch(s){let e="更新标签失败";throw s.response&&400===s.response.status&&s.response.data&&"标签名称已存在"===s.response.data.message?e="标签名称已存在":s.response&&s.response.data&&s.response.data.message&&(e=s.response.data.message),t("SET_ERROR",e),t("SET_LOADING",!1),s}},async deleteTag({commit:t},e){t("SET_LOADING",!0),t("SET_ERROR",null);try{await v.delete("/tags/"+e),t("REMOVE_TAG",e),t("SET_LOADING",!1)}catch(a){let e="删除标签失败";throw a.response&&a.response.data&&a.response.data.message&&(e=a.response.data.message),t("SET_ERROR",e),t("SET_LOADING",!1),a}}};var R={namespaced:!0,state:O,getters:I,actions:F,mutations:x};s["default"].use(o["a"]);var k=new o["a"].Store({modules:{auth:T,favorites:w,tags:R}}),D=function(){var t=this,e=t._self._c;return e("div",{staticClass:"home-page text-center my-5"},[e("h1",{staticClass:"display-4"},[t._v("欢迎来到Telegram收藏夹")]),e("p",{staticClass:"lead"},[t._v("轻松管理和查看您在Telegram中收藏的所有内容。")]),e("hr",{staticClass:"my-4"}),e("p",[t._v("点击导航栏开始浏览您的收藏，或前往设置管理您的Telegram账户。")]),t.isLoggedIn?e("b-button",{attrs:{variant:"info",to:"/favorites"}},[t._v("查看我的收藏")]):e("b-button",{staticClass:"me-2",attrs:{variant:"primary",to:"/login"}},[t._v("立即登录")])],1)},N=[],L={name:"Home",computed:{...Object(o["c"])("auth",["isLoggedIn"])}},P=L,$=(a("4638"),Object(c["a"])(P,D,N,!1,null,"97b98a6e",null)),M=$.exports,G=function(){var t=this,e=t._self._c;return e("div",{staticClass:"login-page"},[e("b-container",[e("b-row",{staticClass:"justify-content-center"},[e("b-col",{attrs:{md:"6"}},[e("b-card",{attrs:{"no-body":""}},[e("b-card-header",{attrs:{"header-tag":"nav"}},[e("b-nav",{attrs:{"card-header":"",tabs:""}},[e("b-nav-item",{attrs:{active:"login"===t.activeTab},on:{click:function(e){t.activeTab="login"}}},[t._v("登录")]),e("b-nav-item",{attrs:{active:"register"===t.activeTab},on:{click:function(e){t.activeTab="register"}}},[t._v("注册")])],1)],1),e("b-card-body",[t.hasError?e("b-alert",{attrs:{show:"",variant:"danger"}},[t._v(t._s(t.errorMessage))]):t._e(),t.successMessage?e("b-alert",{attrs:{show:"",variant:"success"}},[t._v(t._s(t.successMessage))]):t._e(),"login"===t.activeTab?e("div",[e("h4",{staticClass:"text-center mb-4"},[t._v("登录到Telegram收藏夹")]),e("b-form",{on:{submit:function(e){return e.preventDefault(),t.handleLogin.apply(null,arguments)}}},[e("b-form-group",{attrs:{label:"用户名:","label-for":"username"}},[e("b-form-input",{attrs:{id:"username",type:"text",placeholder:"请输入用户名",required:""},model:{value:t.loginForm.username,callback:function(e){t.$set(t.loginForm,"username",e)},expression:"loginForm.username"}})],1),e("b-form-group",{attrs:{label:"密码:","label-for":"password"}},[e("b-form-input",{attrs:{id:"password",type:"password",placeholder:"请输入密码",required:""},model:{value:t.loginForm.password,callback:function(e){t.$set(t.loginForm,"password",e)},expression:"loginForm.password"}})],1),e("b-button",{staticClass:"w-100",attrs:{type:"submit",variant:"primary",disabled:t.isLoading}},[t.isLoading?e("b-spinner",{attrs:{small:"",type:"grow"}}):t._e(),t._v(" 登录 ")],1)],1)],1):t._e(),"register"===t.activeTab?e("div",[e("h4",{staticClass:"text-center mb-4"},[t._v("注册新账号")]),e("b-form",{on:{submit:function(e){return e.preventDefault(),t.handleRegister.apply(null,arguments)}}},[e("b-form-group",{attrs:{label:"用户名:","label-for":"reg-username"}},[e("b-form-input",{attrs:{id:"reg-username",type:"text",placeholder:"请输入用户名",required:""},model:{value:t.registerForm.username,callback:function(e){t.$set(t.registerForm,"username",e)},expression:"registerForm.username"}})],1),e("b-form-group",{attrs:{label:"密码:","label-for":"reg-password"}},[e("b-form-input",{attrs:{id:"reg-password",type:"password",placeholder:"请输入密码",required:""},model:{value:t.registerForm.password,callback:function(e){t.$set(t.registerForm,"password",e)},expression:"registerForm.password"}})],1),e("b-form-group",{attrs:{label:"确认密码:","label-for":"reg-confirm-password"}},[e("b-form-input",{attrs:{id:"reg-confirm-password",type:"password",placeholder:"请再次输入密码",required:"",state:t.passwordMatchState},model:{value:t.registerForm.confirmPassword,callback:function(e){t.$set(t.registerForm,"confirmPassword",e)},expression:"registerForm.confirmPassword"}}),e("b-form-invalid-feedback",{attrs:{state:t.passwordMatchState}},[t._v(" 两次输入的密码不一致 ")])],1),e("h5",{staticClass:"mt-4"},[t._v("添加Telegram账号（可选）")]),e("p",{staticClass:"text-muted small"},[t._v("您可以在注册后在设置页面添加Telegram账号")]),e("b-form-group",{attrs:{label:"API ID:","label-for":"api-id"}},[e("b-form-input",{attrs:{id:"api-id",type:"text",placeholder:"请输入Telegram API ID"},model:{value:t.registerForm.apiId,callback:function(e){t.$set(t.registerForm,"apiId",e)},expression:"registerForm.apiId"}})],1),e("b-form-group",{attrs:{label:"API Hash:","label-for":"api-hash"}},[e("b-form-input",{attrs:{id:"api-hash",type:"text",placeholder:"请输入Telegram API Hash"},model:{value:t.registerForm.apiHash,callback:function(e){t.$set(t.registerForm,"apiHash",e)},expression:"registerForm.apiHash"}})],1),e("b-form-group",{attrs:{label:"SESSION_STRING:","label-for":"session-string"}},[e("b-form-textarea",{attrs:{id:"session-string",rows:"3",placeholder:"请输入Telegram SESSION_STRING"},model:{value:t.registerForm.sessionString,callback:function(e){t.$set(t.registerForm,"sessionString",e)},expression:"registerForm.sessionString"}}),e("small",{staticClass:"form-text text-muted"},[e("a",{attrs:{href:"#"},on:{click:function(e){e.preventDefault(),t.showSessionHelp=!0}}},[t._v("如何获取SESSION_STRING?")])])],1),e("b-button",{staticClass:"w-100",attrs:{type:"submit",variant:"primary",disabled:t.isLoading||!t.isRegisterFormValid}},[t.isLoading?e("b-spinner",{attrs:{small:"",type:"grow"}}):t._e(),t._v(" 注册 ")],1)],1)],1):t._e()],1)],1)],1)],1)],1),e("b-modal",{attrs:{id:"session-help-modal",title:"如何获取SESSION_STRING","ok-only":""},model:{value:t.showSessionHelp,callback:function(e){t.showSessionHelp=e},expression:"showSessionHelp"}},[e("div",[e("p",[t._v("获取Telegram SESSION_STRING的步骤：")]),e("ol",[e("li",[t._v("安装Python 3.8+")]),e("li",[t._v("安装Telethon库: "),e("code",[t._v("pip install telethon")])]),e("li",[t._v("创建并运行以下Python脚本：")])]),e("pre",[e("code",[t._v('from telethon.sync import TelegramClient\nfrom telethon.sessions import StringSession\n\nAPI_ID = "您的API_ID"\nAPI_HASH = "您的API_HASH"\n\nwith TelegramClient(StringSession(), API_ID, API_HASH) as client:\n    print("请登录您的Telegram账号...")\n    client.start()\n    session_string = client.session.save()\n    print(f"您的SESSION_STRING: {session_string}")')])]),e("p",[t._v("运行脚本后，按照提示登录您的Telegram账号，然后复制生成的SESSION_STRING。")]),e("p",{staticClass:"text-danger"},[t._v("注意：SESSION_STRING包含敏感信息，请勿与他人分享。")])])])],1)},j=[],H={name:"Login",data(){return{activeTab:"login",showSessionHelp:!1,successMessage:"",loginForm:{username:"",password:""},registerForm:{username:"",password:"",confirmPassword:"",apiId:"",apiHash:"",sessionString:""}}},computed:{...Object(o["c"])("auth",["isLoading","hasError","errorMessage"]),passwordMatchState(){return 0===this.registerForm.password.length&&0===this.registerForm.confirmPassword.length?null:this.registerForm.password===this.registerForm.confirmPassword},isRegisterFormValid(){if(!this.registerForm.username||!this.registerForm.password||!this.registerForm.confirmPassword)return!1;if(this.registerForm.password!==this.registerForm.confirmPassword)return!1;const{apiId:t,apiHash:e,sessionString:a}=this.registerForm;return!(t||e||a)||t&&e&&a}},methods:{...Object(o["b"])("auth",["login","register","clearError"]),async handleLogin(){if(this.clearError(),this.successMessage="",this.loginForm.username&&this.loginForm.password)try{await this.login({username:this.loginForm.username,password:this.loginForm.password});const t=this.$route.query.redirect||"/favorites";this.$router.replace(t),this.loginForm.username="",this.loginForm.password=""}catch(t){this.$bvToast.toast(this.errorMessage||"登录失败，请重试",{title:"登录错误",variant:"danger",solid:!0})}else this.$bvToast.toast("请输入用户名和密码",{title:"提示",variant:"warning",solid:!0})},async handleRegister(){if(this.clearError(),this.successMessage="",this.isRegisterFormValid)try{const t={username:this.registerForm.username,password:this.registerForm.password};this.registerForm.apiId&&this.registerForm.apiHash&&this.registerForm.sessionString&&(t.telegramAccounts=[{name:"默认账号",apiId:this.registerForm.apiId,apiHash:this.registerForm.apiHash,sessionString:this.registerForm.sessionString}]),await this.register(t),this.activeTab="login",this.successMessage="注册成功，请登录！",this.registerForm={username:"",password:"",confirmPassword:"",apiId:"",apiHash:"",sessionString:""},this.$bvToast.toast("注册成功，请登录",{title:"注册成功",variant:"success",solid:!0})}catch(t){this.$bvToast.toast(this.errorMessage||"注册失败，请稍后重试",{title:"注册错误",variant:"danger",solid:!0})}else this.$bvToast.toast("请检查表单字段，确保密码一致且Telegram凭证完整",{title:"验证失败",variant:"warning",solid:!0})}},created(){this.clearError()}},U=H,q=(a("9871"),Object(c["a"])(U,G,j,!1,null,"162e6c60",null)),V=q.exports,Q=function(){var t=this,e=t._self._c;return e("div",{staticClass:"favorites-page"},[e("div",{staticClass:"filter-toolbar mb-4"},[e("div",{staticClass:"card"},[e("div",{staticClass:"card-body"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-md-3 mb-2"},[e("label",{staticClass:"form-label"},[t._v("内容类型")]),e("b-form-select",{attrs:{options:t.typeOptions},on:{change:t.applyFilters},model:{value:t.filters.type,callback:function(e){t.$set(t.filters,"type",e)},expression:"filters.type"}})],1),e("div",{staticClass:"col-md-3 mb-2"},[e("label",{staticClass:"form-label"},[t._v("分类")]),e("b-form-select",{attrs:{options:t.categoryOptions},on:{change:t.applyFilters},model:{value:t.filters.category,callback:function(e){t.$set(t.filters,"category",e)},expression:"filters.category"}})],1),e("div",{staticClass:"col-md-3 mb-2"},[e("label",{staticClass:"form-label"},[t._v("标签")]),e("b-form-select",{attrs:{options:t.tagOptions,multiple:""},on:{change:t.applyFilters},model:{value:t.filters.tags,callback:function(e){t.$set(t.filters,"tags",e)},expression:"filters.tags"}})],1),e("div",{staticClass:"col-md-3 mb-2"},[e("label",{staticClass:"form-label"},[t._v("排序方式")]),e("div",{staticClass:"d-flex"},[e("b-form-select",{staticClass:"me-2",attrs:{options:t.sortByOptions},on:{change:t.applyFilters},model:{value:t.filters.sortBy,callback:function(e){t.$set(t.filters,"sortBy",e)},expression:"filters.sortBy"}}),e("b-button",{attrs:{variant:"outline-secondary"},on:{click:t.toggleSortOrder}},[e("i",{class:t.sortOrderIcon})])],1)])]),e("div",{staticClass:"row mt-3"},[e("div",{staticClass:"col-md-8"},[e("div",{staticClass:"input-group"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.searchQuery,expression:"searchQuery"}],staticClass:"form-control",attrs:{type:"text",placeholder:"搜索收藏..."},domProps:{value:t.searchQuery},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.search.apply(null,arguments)},input:function(e){e.target.composing||(t.searchQuery=e.target.value)}}}),e("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:t.search}},[t._v("搜索")])])]),e("div",{staticClass:"col-md-4 text-end"},[e("b-button",{attrs:{variant:"success",disabled:t.syncLoading||!t.hasActiveAccount},on:{click:t.syncFavorites}},[e("i",{staticClass:"bi bi-arrow-repeat me-1"}),t._v(" 同步收藏 ")])],1)])])])]),t.loading?e("div",{staticClass:"text-center my-5"},[t._m(0),e("p",{staticClass:"mt-2"},[t._v("正在加载收藏内容...")])]):t.hasError?e("div",{staticClass:"alert alert-danger"},[t._v(" "+t._s(t.errorMessage)+" ")]):0===t.favorites.length?e("div",{staticClass:"text-center my-5"},[t._m(1)]):e("div",[e("div",{staticClass:"view-toggle mb-3 text-end"},[e("div",{staticClass:"btn-group"},[e("button",{staticClass:"btn",class:{"btn-primary":"grid"===t.viewMode,"btn-outline-primary":"grid"!==t.viewMode},attrs:{type:"button"},on:{click:function(e){t.viewMode="grid"}}},[e("i",{staticClass:"bi bi-grid-3x3-gap"})]),e("button",{staticClass:"btn",class:{"btn-primary":"list"===t.viewMode,"btn-outline-primary":"list"!==t.viewMode},attrs:{type:"button"},on:{click:function(e){t.viewMode="list"}}},[e("i",{staticClass:"bi bi-list"})])])]),"grid"===t.viewMode?e("div",{staticClass:"row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4"},t._l(t.favorites,(function(a){return e("div",{key:a._id,staticClass:"col"},[e("div",{staticClass:"card h-100"},["photo"===a.type||"video"===a.type?e("div",{staticClass:"card-img-top favorite-media"},["video"===a.type?e("div",{staticClass:"video-thumbnail position-relative"},[e("img",{staticClass:"img-fluid",attrs:{src:a.content.thumbnailUrl||"/assets/img/video-placeholder.jpg",alt:"视频缩略图"}}),t._m(2,!0)]):e("img",{staticClass:"img-fluid",attrs:{src:a.content.url||"/assets/img/image-placeholder.jpg",alt:"图片"}})]):"document"===a.type?e("div",{staticClass:"card-img-top text-center p-3 bg-light"},[e("i",{staticClass:"bi bi-file-earmark-text display-4"})]):"link"===a.type?e("div",{staticClass:"card-img-top text-center p-3 bg-light"},[e("i",{staticClass:"bi bi-link-45deg display-4"})]):e("div",{staticClass:"card-img-top text-center p-3 bg-light"},[e("i",{staticClass:"bi bi-chat-quote display-4"})]),e("div",{staticClass:"card-body"},[e("h5",{staticClass:"card-title"},[t._v(" "+t._s(t._f("truncate")(a.content.caption||a.content.text||"无标题",50))+" ")]),e("p",{staticClass:"card-text text-muted small"},[t._v(" "+t._s(t.formatDate(a.savedAt))+" · "+t._s(a.category)+" ")]),e("div",{staticClass:"tags mt-2"},t._l(a.tags||[],(function(a){return e("span",{key:a,staticClass:"badge bg-info me-1 mb-1"},[t._v(" "+t._s(a)+" ")])})),0)]),e("div",{staticClass:"card-footer bg-white border-top-0"},[e("div",{staticClass:"d-flex justify-content-between"},[e("router-link",{staticClass:"btn btn-sm btn-outline-primary",attrs:{to:"/favorites/"+a._id}},[t._v(" 查看详情 ")]),e("button",{staticClass:"btn btn-sm btn-outline-danger",on:{click:function(e){return t.confirmDelete(a)}}},[e("i",{staticClass:"bi bi-trash"})])],1)])])])})),0):t._e()]),e("div",{staticClass:"pagination-container mt-4 d-flex justify-content-center"},[e("b-pagination",{attrs:{"total-rows":t.pagination.total,"per-page":t.pagination.limit,"aria-controls":"favorites-table"},on:{change:t.changePage},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}})],1),e("b-modal",{attrs:{id:"delete-modal",title:"确认删除"},on:{ok:t.deleteFavorite}},[e("p",[t._v("确定要删除这个收藏吗？此操作无法撤销。")])])],1)},B=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"spinner-border text-primary",attrs:{role:"status"}},[e("span",{staticClass:"visually-hidden"},[t._v("加载中...")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"empty-state"},[e("i",{staticClass:"bi bi-bookmark-star display-1 text-muted"}),e("h3",{staticClass:"mt-3"},[t._v("暂无收藏内容")]),e("p",{staticClass:"text-muted"},[t._v('您可以点击"同步收藏"按钮从Telegram同步您的收藏内容')])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"play-icon"},[e("i",{staticClass:"bi bi-play-circle-fill"})])}],z={name:"Favorites",data(){return{viewMode:"grid",currentPage:1,searchQuery:"",favoriteToDelete:null,filters:{type:null,category:null,tags:[],sortBy:"savedAt",sortOrder:"desc"},typeOptions:[{value:null,text:"所有类型"},{value:"photo",text:"图片"},{value:"video",text:"视频"},{value:"document",text:"文档"},{value:"link",text:"链接"},{value:"text",text:"文本"}],categoryOptions:[{value:null,text:"所有分类"},{value:"图片",text:"图片"},{value:"视频",text:"视频"},{value:"文档",text:"文档"},{value:"链接",text:"链接"},{value:"文本",text:"文本"},{value:"其他",text:"其他"}],sortByOptions:[{value:"savedAt",text:"收藏时间"},{value:"type",text:"内容类型"},{value:"category",text:"分类"}]}},computed:{...Object(o["c"])("favorites",["allFavorites","loading","error","pagination","filters"]),...Object(o["c"])("tags",["allTags"]),favorites(){return this.allFavorites},tagOptions(){return[{value:null,text:"所有标签"},...(this.allTags||[]).map(t=>({value:t.name,text:`${t.name} (${t.count})`}))]},sortOrderIcon(){return"asc"===this.filters.sortOrder?"bi bi-sort-up-alt":"bi bi-sort-down-alt"}},methods:{...Object(o["b"])("favorites",["fetchFavorites","deleteFavorite","updateFiltersAndFetch","searchFavorites","syncFavorites"]),...Object(o["b"])("tags",["fetchTags"]),applyFilters(){this.currentPage=1,this.updateFiltersAndFetch({...this.filters,page:this.currentPage,search:this.searchQuery.trim()})},toggleSortOrder(){this.filters.sortOrder="asc"===this.filters.sortOrder?"desc":"asc",this.applyFilters()},search(){const t=this.searchQuery.trim();this.currentPage=1,this.updateFiltersAndFetch({...this.filters,search:t,page:this.currentPage})},changePage(t){this.currentPage=t,this.updateFiltersAndFetch({...this.filters,search:this.searchQuery.trim(),page:this.currentPage})},confirmDelete(t){this.favoriteToDelete=t,this.$bvModal.show("delete-modal")},async deleteFavorite(){if(this.favoriteToDelete)try{await this.deleteFavorite(this.favoriteToDelete._id),this.$bvToast.toast("收藏已删除",{title:"成功",variant:"success",solid:!0})}catch(t){console.error("删除收藏失败:",t),this.$bvToast.toast(this.errorMessage||"删除收藏失败，请重试",{title:"错误",variant:"danger",solid:!0})}finally{this.favoriteToDelete=null}},formatDate(t){if("function"===typeof this.$_formatDate)return this.$_formatDate(t);{const e=new Date(t);return e.toLocaleDateString("zh-CN",{year:"numeric",month:"short",day:"numeric"})}}},filters:{truncate(t,e){return t?t.length>e?t.substring(0,e)+"...":t:""}},async created(){if(this.$store.getters["auth/isAuthenticated"])try{await this.fetchTags(),await this.fetchFavorites()}catch(t){console.error("加载收藏或标签失败:",t),this.$bvToast.toast(this.errorMessage||"加载数据失败，请刷新重试",{title:"错误",variant:"danger",solid:!0})}else this.$router.replace("/login")},watch:{"$route.query":{immediate:!0,handler(t){t.q?this.searchQuery=t.q:this.searchQuery="",this.applyFilters()}}}},Y=z,K=(a("754b"),Object(c["a"])(Y,Q,B,!1,null,"5bd26497",null)),J=K.exports,W=function(){var t=this,e=t._self._c;return e("div",{staticClass:"favorite-detail-page"},[e("b-container",[e("h1",{staticClass:"my-4"},[t._v("收藏详情")]),t.hasError?e("b-alert",{attrs:{show:"",variant:"danger"}},[t._v(t._s(t.errorMessage))]):t.isLoading?e("div",{staticClass:"text-center my-5"},[e("b-spinner",{staticClass:"text-primary"}),e("p",{staticClass:"mt-2"},[t._v("加载收藏详情...")])],1):t.favorite?e("b-card",{staticClass:"mb-4"},[e("b-card-body",[e("b-row",[e("b-col",{attrs:{md:"8"}},[e("div",{staticClass:"main-content-display mb-3"},["photo"===t.favorite.type?[e("b-img",{attrs:{src:t.favorite.content.url,fluid:"",alt:"收藏图片"}})]:"video"===t.favorite.type?[t.favorite.localPath?e("video",{staticClass:"w-100",attrs:{src:t.favorite.localPath,controls:"",fluid:""}},[t._v(" 您的浏览器不支持视频播放。 ")]):e("b-img",{attrs:{src:t.favorite.content.thumbnailUrl||t.videoPlaceholder,fluid:"",alt:"视频缩略图"}}),t.favorite.localPath?t._e():e("div",{staticClass:"text-muted text-center mt-2"},[e("i",{staticClass:"bi bi-info-circle me-1"}),t._v(" 视频文件可能未下载到服务器，无法直接播放。 ")])]:"audio"===t.favorite.type?[t.favorite.localPath?e("audio",{staticClass:"w-100",attrs:{src:t.favorite.localPath,controls:""}},[t._v(" 您的浏览器不支持音频播放。 ")]):e("div",{staticClass:"text-muted text-center mt-2"},[e("i",{staticClass:"bi bi-info-circle me-1"}),t._v(" 音频文件可能未下载到服务器。 ")])]:"document"===t.favorite.type?[e("a",{staticClass:"btn btn-outline-primary w-100 py-3",attrs:{href:t.favorite.localPath||"#",target:"_blank"}},[e("i",{staticClass:"bi bi-file-earmark-arrow-down-fill me-2"}),t._v(" 下载文件: "+t._s(t.favorite.content.fileName)+" ")]),t.favorite.localPath?t._e():e("div",{staticClass:"text-muted text-center mt-2"},[e("i",{staticClass:"bi bi-info-circle me-1"}),t._v(" 文件可能未下载到服务器。 ")])]:"link"===t.favorite.type?[e("a",{staticClass:"btn btn-outline-info w-100 py-3",attrs:{href:t.favorite.content.url,target:"_blank"}},[e("i",{staticClass:"bi bi-link-45deg me-2"}),t._v(" 前往链接: "+t._s(t._f("$_truncateText")(t.favorite.content.url,50))+" ")])]:"text"===t.favorite.type?[e("div",{staticClass:"card p-3 bg-light text-start"},[e("h5",{staticClass:"mb-2"},[t._v("文本内容:")]),e("pre",{staticClass:"mb-0"},[t._v(t._s(t.favorite.content.text))])])]:[e("div",{staticClass:"text-center p-5 bg-light"},[e("i",{staticClass:"bi bi-question-circle display-4 text-muted"}),e("p",{staticClass:"mt-2"},[t._v("未知内容类型")])])]],2),e("h4",{staticClass:"mb-2"},[t._v(t._s(t.favorite.content.caption||t.favorite.content.text||"无标题"))]),e("p",{staticClass:"text-muted small"},[t._v(" 收藏时间: "+t._s(t._f("$_formatDate")(t.favorite.savedAt))+" "),e("br"),t._v(" 分类: "+t._s(t.favorite.category||"未分类")+" "),e("br"),t._v(" 消息ID: "+t._s(t.favorite.telegramMessageId)+" ")]),e("div",{staticClass:"d-flex gap-2 mt-3"},[e("b-button",{attrs:{variant:"outline-danger"},on:{click:t.confirmDelete}},[e("i",{staticClass:"bi bi-trash me-1"}),t._v(" 删除收藏 ")])],1)]),e("b-col",{attrs:{md:"4"}},[e("b-card",{staticClass:"mb-3",attrs:{header:"标签"}},[e("div",{staticClass:"tags-list"},t._l(t.favorite.tags,(function(a){return e("b-badge",{key:a._id||a,staticClass:"tag-badge-style me-1 mb-1",attrs:{pill:""},on:{click:function(e){return t.removeTag(a)}}},[t._v(" "+t._s(a.name||a)+" "),e("i",{staticClass:"bi bi-x-circle-fill ms-1"})])})),1),e("hr"),e("b-form",{on:{submit:function(e){return e.preventDefault(),t.addTag.apply(null,arguments)}}},[e("b-form-group",{attrs:{label:"添加新标签:","label-for":"add-tag-input"}},[e("b-form-input",{attrs:{id:"add-tag-input",placeholder:"输入标签名称",required:""},model:{value:t.newTag,callback:function(e){t.newTag=e},expression:"newTag"}})],1),e("b-button",{staticClass:"mt-2",attrs:{type:"submit",variant:"outline-primary",size:"sm",disabled:!t.newTag.trim()}},[t._v("添加标签")])],1)],1),e("b-card",{staticClass:"mb-3",attrs:{header:"其他信息"}},[e("p",[e("strong",[t._v("文件ID:")]),t._v(" "+t._s(t.favorite.content.fileId||"N/A"))]),e("p",[e("strong",[t._v("文件名:")]),t._v(" "+t._s(t.favorite.content.fileName||"N/A"))]),e("p",[e("strong",[t._v("文件大小:")]),t._v(" "+t._s(t.favorite.content.fileSize?(t.favorite.content.fileSize/1024/1024).toFixed(2)+" MB":"N/A"))]),e("p",[e("strong",[t._v("MIME类型:")]),t._v(" "+t._s(t.favorite.content.mimeType||"N/A"))]),e("p",[e("strong",[t._v("时长:")]),t._v(" "+t._s(t.favorite.content.duration?t.favorite.content.duration+" 秒":"N/A"))]),e("p",[e("strong",[t._v("分辨率:")]),t._v(" "+t._s(t.favorite.content.width||"N/A")+" x "+t._s(t.favorite.content.height||"N/A"))]),e("p",[e("strong",[t._v("本地下载:")]),t.favorite.isDownloaded?e("i",{staticClass:"bi bi-check-circle-fill text-success"}):e("i",{staticClass:"bi bi-x-circle-fill text-danger"}),t._v(" "+t._s(t.favorite.isDownloaded?"已下载":"未下载")+" ")]),t.favorite.localPath?e("p",[e("strong",[t._v("本地路径:")]),t._v(" "+t._s(t.favorite.localPath))]):t._e()])],1)],1)],1)],1):e("b-alert",{attrs:{show:"",variant:"warning"}},[e("i",{staticClass:"bi bi-exclamation-triangle me-1"}),t._v(" 未找到该收藏内容。 ")])],1),e("b-modal",{attrs:{id:"delete-modal-detail",title:"确认删除","ok-variant":"danger","ok-title":"删除"},on:{ok:t.deleteFavorite}},[e("p",[t._v("确定要删除这个收藏吗？此操作无法撤销。")])])],1)},X=[],Z={name:"FavoriteDetail",data(){return{newTag:"",imagePlaceholder:a("e4a0"),videoPlaceholder:a("deac")}},computed:{...Object(o["c"])("favorites",["currentFavorite","isLoading","hasError","errorMessage"]),favorite(){return this.currentFavorite}},methods:{...Object(o["b"])("favorites",["fetchFavoriteById","deleteFavorite","updateFavoriteTags","removeTagFromFavorite"]),async addTag(){if(!this.newTag.trim())return void this.$bvToast.toast("标签名称不能为空",{title:"验证错误",variant:"warning",solid:!0});const t=this.favorite.tags.find(t=>("string"===typeof t?t.toLowerCase():t.name.toLowerCase())===this.newTag.trim().toLowerCase());if(t)this.$bvToast.toast("该标签已存在于此收藏中",{title:"提示",variant:"info",solid:!0});else try{const t=[...this.favorite.tags.map(t=>"string"===typeof t?t:t.name),this.newTag.trim()];await this.updateFavoriteTags({favoriteId:this.favorite._id,tags:t}),this.newTag="",this.$bvToast.toast("标签添加成功",{title:"成功",variant:"success",solid:!0})}catch(e){this.$bvToast.toast(this.errorMessage||"添加标签失败，请重试",{title:"错误",variant:"danger",solid:!0})}},async removeTag(t){if(confirm(`确定要移除标签 "${"string"===typeof t?t:t.name}" 吗？`))try{const e="string"===typeof t?t:t.name;await this.removeTagFromFavorite({favoriteId:this.favorite._id,tagName:e}),this.$bvToast.toast("标签已移除",{title:"成功",variant:"success",solid:!0})}catch(e){this.$bvToast.toast(this.errorMessage||"移除标签失败，请重试",{title:"错误",variant:"danger",solid:!0})}},confirmDelete(){this.$bvModal.show("delete-modal-detail")},async deleteFavorite(){try{await this.deleteFavorite(this.favorite._id),this.$bvToast.toast("收藏已删除",{title:"成功",variant:"success",solid:!0}),this.$router.push("/favorites")}catch(t){this.$bvToast.toast(this.errorMessage||"删除失败，请重试",{title:"错误",variant:"danger",solid:!0})}}},created(){const t=this.$route.params.id;t&&this.fetchFavoriteById(t)},watch:{"$route.params.id":{handler(t){t&&this.fetchFavoriteById(t)},immediate:!0}}},tt=Z,et=(a("e5f2"),Object(c["a"])(tt,W,X,!1,null,"76cf7e89",null)),at=et.exports,st=function(){var t=this,e=t._self._c;return e("div",{staticClass:"tags-container"},[e("b-container",[e("h1",{staticClass:"my-4"},[t._v("标签管理")]),e("b-card",{staticClass:"mb-4",scopedSlots:t._u([{key:"header",fn:function(){return[e("div",{staticClass:"d-flex justify-content-between align-items-center"},[e("h4",{staticClass:"mb-0"},[t._v("所有标签")]),e("b-button",{attrs:{variant:"primary",size:"sm",disabled:!t.hasActiveAccount},on:{click:t.showAddTagModal}},[e("i",{staticClass:"bi bi-plus-circle me-1"}),t._v(" 添加标签 ")])],1),t.hasActiveAccount?t._e():e("b-alert",{staticClass:"mt-2 py-2",attrs:{show:"",variant:"warning"}},[e("small",[t._v("请先在 "),e("router-link",{attrs:{to:"/settings"}},[t._v("设置")]),t._v(" 页面添加Telegram账户才能添加标签。")],1)])]},proxy:!0}])},[e("b-table",{staticClass:"mb-0",attrs:{items:t.allTags,fields:t.fields,striped:"",hover:"",responsive:"",busy:t.isLoading},scopedSlots:t._u([{key:"cell(color)",fn:function(a){return[a.item.color?e("div",{staticClass:"color-preview",style:{backgroundColor:a.item.color}}):e("span",{staticClass:"text-muted"},[t._v("无")])]}},{key:"cell(count)",fn:function(e){return[t._v(" "+t._s(e.item.count||0)+" 个收藏 ")]}},{key:"cell(actions)",fn:function(a){return[e("b-button-group",{attrs:{size:"sm"}},[e("b-button",{attrs:{variant:"outline-primary"},on:{click:function(e){return t.showEditTagModal(a.item)}}},[e("i",{staticClass:"bi bi-pencil"})]),e("b-button",{attrs:{variant:"outline-danger"},on:{click:function(e){return t.showDeleteTagModal(a.item)}}},[e("i",{staticClass:"bi bi-trash"})])],1)]}},{key:"table-busy",fn:function(){return[e("div",{staticClass:"text-center my-2"},[e("b-spinner",{staticClass:"align-middle"}),e("strong",[t._v(" 加载中...")])],1)]},proxy:!0}])}),!t.isLoading&&0===t.allTags.length&&t.hasActiveAccount?e("div",{staticClass:"text-center py-3"},[e("p",{staticClass:"text-muted"},[t._v('暂无标签，请点击"添加标签"按钮创建。')])]):t._e()],1)],1),e("b-modal",{attrs:{title:t.isEditing?"编辑标签":"添加标签","ok-disabled":!t.tagForm.name.trim()},on:{ok:t.handleTagSubmit,hidden:t.resetTagForm},model:{value:t.showTagModal,callback:function(e){t.showTagModal=e},expression:"showTagModal"}},[e("b-form",[e("b-form-group",{attrs:{label:"标签名称:","label-for":"tag-name"}},[e("b-form-input",{attrs:{id:"tag-name",required:"",placeholder:"输入标签名称"},model:{value:t.tagForm.name,callback:function(e){t.$set(t.tagForm,"name",e)},expression:"tagForm.name"}})],1),e("b-form-group",{attrs:{label:"标签颜色 (可选):","label-for":"tag-color"}},[e("b-form-input",{attrs:{id:"tag-color",type:"color"},model:{value:t.tagForm.color,callback:function(e){t.$set(t.tagForm,"color",e)},expression:"tagForm.color"}})],1)],1)],1),e("b-modal",{attrs:{title:"删除标签","ok-variant":"danger","ok-title":"删除"},on:{ok:t.deleteTag},model:{value:t.showDeleteModal,callback:function(e){t.showDeleteModal=e},expression:"showDeleteModal"}},[e("p",[t._v('确定要删除标签 "'),e("strong",[t._v(t._s(t.tagToDelete?t.tagToDelete.name:""))]),t._v('" 吗？')]),e("p",{staticClass:"text-danger"},[t._v("此操作将从所有收藏中移除该标签，且无法撤销。")])])],1)},rt=[],it={name:"Tags",data(){return{fields:[{key:"name",label:"标签名称",sortable:!0},{key:"color",label:"颜色"},{key:"count",label:"收藏数量",sortable:!0},{key:"actions",label:"操作"}],showTagModal:!1,showDeleteModal:!1,isEditing:!1,tagForm:{_id:null,name:"",color:"#3498db"},tagToDelete:null}},computed:{...Object(o["c"])("tags",["allTags","isLoading","hasError","errorMessage"]),...Object(o["c"])("auth",["hasActiveAccount"])},created(){this.fetchTags()},methods:{...Object(o["b"])("tags",["fetchTags","createTag","updateTag","deleteTag"]),showAddTagModal(){this.isEditing=!1,this.resetTagForm(),this.showTagModal=!0},showEditTagModal(t){this.isEditing=!0,this.tagForm={...t},this.showTagModal=!0},showDeleteTagModal(t){this.tagToDelete=t,this.showDeleteModal=!0},async handleTagSubmit(t){if(t.preventDefault(),this.tagForm.name.trim())try{this.isEditing?(await this.updateTag({id:this.tagForm._id,tagData:{name:this.tagForm.name.trim(),color:this.tagForm.color}}),this.$bvToast.toast("标签已更新",{title:"成功",variant:"success",solid:!0})):(await this.createTag({name:this.tagForm.name.trim(),color:this.tagForm.color}),this.$bvToast.toast("标签已创建",{title:"成功",variant:"success",solid:!0})),this.showTagModal=!1}catch(e){this.$bvToast.toast(this.errorMessage||"操作失败，请重试",{title:"错误",variant:"danger",solid:!0})}else this.$bvToast.toast("标签名称不能为空",{title:"验证错误",variant:"warning",solid:!0})},async deleteTag(){if(this.tagToDelete)try{await this.deleteTag(this.tagToDelete._id),this.$bvToast.toast("标签已删除",{title:"成功",variant:"success",solid:!0})}catch(t){this.$bvToast.toast(this.errorMessage||"删除失败，请重试",{title:"错误",variant:"danger",solid:!0})}finally{this.tagToDelete=null}},resetTagForm(){this.tagForm={_id:null,name:"",color:"#3498db"}}}},ot=it,nt=(a("22fc"),Object(c["a"])(ot,st,rt,!1,null,"6faafcf3",null)),lt=nt.exports,ct=function(){var t=this,e=t._self._c;return e("div",{staticClass:"search-page"},[e("h1",{staticClass:"my-4"},[t._v("搜索结果")]),e("b-card",{staticClass:"mb-4"},[e("b-card-body",[e("div",{staticClass:"input-group"},[e("b-form-input",{attrs:{type:"text",placeholder:"输入搜索关键字..."},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.performSearch.apply(null,arguments)}},model:{value:t.searchQuery,callback:function(e){t.searchQuery=e},expression:"searchQuery"}}),e("b-button",{attrs:{variant:"primary",type:"button"},on:{click:t.performSearch}},[e("i",{staticClass:"bi bi-search me-1"}),t._v(" 搜索 ")]),e("b-button",{attrs:{variant:"outline-secondary",type:"button"},on:{click:t.clearSearch}},[e("i",{staticClass:"bi bi-x-lg"}),t._v(" 清除 ")])],1)])],1),t.isLoading?e("div",{staticClass:"text-center my-5"},[e("b-spinner",{staticClass:"text-primary"}),e("p",{staticClass:"mt-2"},[t._v("正在搜索收藏内容...")])],1):t.hasError?e("b-alert",{attrs:{show:"",variant:"danger"}},[t._v(t._s(t.errorMessage))]):0===t.favorites.length?e("div",{staticClass:"text-center my-5 empty-state"},[e("i",{staticClass:"bi bi-search display-1 text-muted"}),e("h3",{staticClass:"mt-3"},[t._v("未找到相关收藏")]),e("p",{staticClass:"text-muted"},[t._v("请尝试不同的搜索关键字。")])]):e("div",[e("h4",{staticClass:"mb-3"},[t._v("找到 "+t._s(t.currentPagination.total)+" 个结果")]),e("b-row",{staticClass:"row-cols-1 row-cols-md-2 row-cols-lg-3 g-4"},t._l(t.favorites,(function(a){return e("b-col",{key:a._id},[e("b-card",{staticClass:"h-100",attrs:{"no-body":""}},[["photo","video","document","audio"].includes(a.type)?e("div",{staticClass:"card-img-top favorite-media"},["video"===a.type?e("div",{staticClass:"video-thumbnail position-relative"},[e("img",{staticClass:"img-fluid",attrs:{src:a.content.thumbnailUrl||t.videoPlaceholder,alt:"视频缩略图"}}),e("div",{staticClass:"play-icon"},[e("i",{staticClass:"bi bi-play-circle-fill"})])]):"photo"===a.type?e("img",{staticClass:"img-fluid",attrs:{src:a.content.url||t.imagePlaceholder,alt:"图片"}}):"document"===a.type?e("div",{staticClass:"text-center p-3 bg-light d-flex flex-column align-items-center justify-content-center h-100"},[e("i",{staticClass:"bi bi-file-earmark-text display-4 text-primary"}),e("p",{staticClass:"mt-2 text-muted small"},[t._v(t._s(a.content.fileName||"文档"))])]):"audio"===a.type?e("div",{staticClass:"text-center p-3 bg-light d-flex flex-column align-items-center justify-content-center h-100"},[e("i",{staticClass:"bi bi-music-note-beamed display-4 text-secondary"}),e("p",{staticClass:"mt-2 text-muted small"},[t._v(t._s(a.content.fileName||"音频"))])]):t._e()]):"link"===a.type?e("div",{staticClass:"card-img-top text-center p-3 bg-light d-flex flex-column align-items-center justify-content-center h-100"},[e("i",{staticClass:"bi bi-link-45deg display-4 text-info"}),e("p",{staticClass:"mt-2 text-muted small"},[t._v(t._s(t._f("$_truncateText")(a.content.url,50)))])]):e("div",{staticClass:"card-img-top text-center p-3 bg-light d-flex flex-column align-items-center justify-content-center h-100"},[e("i",{staticClass:"bi bi-chat-quote display-4 text-secondary"})]),e("b-card-body",[e("b-card-title",{staticClass:"mb-2"},[t._v(" "+t._s(t._f("$_truncateText")(a.content.caption||a.content.text||"无标题",50))+" ")]),e("b-card-text",{staticClass:"text-muted small"},[t._v(" "+t._s(t._f("$_formatDate")(a.savedAt,{year:"numeric",month:"short",day:"numeric"}))+" · "+t._s(a.category||"未分类")+" ")]),e("div",{staticClass:"tags mt-2"},t._l(a.tags,(function(a){return e("b-badge",{key:a._id||a,staticClass:"tag-badge-style me-1 mb-1",attrs:{pill:""},on:{click:function(e){return e.stopPropagation(),t.filterByTag(a)}}},[t._v(" "+t._s(a.name||a)+" ")])})),1)],1),e("b-card-footer",{staticClass:"bg-white border-top-0 d-flex justify-content-between"},[e("router-link",{staticClass:"btn btn-sm btn-outline-primary",attrs:{to:"/favorites/"+a._id}},[t._v(" 查看详情 ")]),e("b-button",{attrs:{variant:"outline-danger",size:"sm"},on:{click:function(e){return t.confirmDelete(a)}}},[e("i",{staticClass:"bi bi-trash"})])],1)],1)],1)})),1),t.currentPagination.total>t.currentPagination.limit?e("div",{staticClass:"pagination-container mt-4 d-flex justify-content-center"},[e("b-pagination",{attrs:{"total-rows":t.currentPagination.total,"per-page":t.currentPagination.limit,"aria-controls":"favorites-list"},on:{change:t.changePage},model:{value:t.currentPagination.page,callback:function(e){t.$set(t.currentPagination,"page",e)},expression:"currentPagination.page"}})],1):t._e()],1),e("b-modal",{attrs:{id:"delete-modal-search",title:"确认删除","ok-variant":"danger","ok-title":"删除"},on:{ok:t.deleteFavorite}},[e("p",[t._v("确定要删除这个收藏吗？此操作无法撤销。")])])],1)},dt=[],ut={name:"Search",data(){return{searchQuery:"",favoriteToDelete:null,imagePlaceholder:a("e4a0"),videoPlaceholder:a("deac")}},computed:{...Object(o["c"])("favorites",["allFavorites","isLoading","hasError","errorMessage","currentFilters","currentPagination"]),...Object(o["c"])("tags",{allTags:"allTags"}),favorites(){return this.allFavorites}},methods:{...Object(o["b"])("favorites",["fetchFavorites","deleteFavorite","updateFiltersAndFetch","setPage"]),performSearch(){this.searchQuery.trim()?this.updateFiltersAndFetch({...this.currentFilters,search:this.searchQuery.trim(),page:1}):this.clearSearch()},clearSearch(){this.searchQuery="",this.updateFiltersAndFetch({...this.currentFilters,search:null,page:1})},filterByTag(t){const e="string"===typeof t?t:t.name;this.$router.push({path:"/favorites",query:{tag:e}})},changePage(t){this.setPage(t)},confirmDelete(t){this.favoriteToDelete=t,this.$bvModal.show("delete-modal-search")},async deleteFavorite(){if(this.favoriteToDelete)try{await this.deleteFavorite(this.favoriteToDelete._id),this.$bvToast.toast("收藏已删除",{title:"成功",variant:"success",solid:!0})}catch(t){this.$bvToast.toast(this.errorMessage||"删除失败，请重试",{title:"错误",variant:"danger",solid:!0})}finally{this.favoriteToDelete=null}}},created(){this.$route.query.q?(this.searchQuery=this.$route.query.q,this.performSearch()):this.clearSearch()},watch:{"$route.query.q":{handler(t){t!==this.searchQuery?(this.searchQuery=t||"",this.performSearch()):!t&&this.searchQuery&&(this.searchQuery="",this.clearSearch())},immediate:!0},"currentPagination.page":{handler(t,e){t!==e&&"Search"===this.$route.name&&this.$route.query.q&&this.performSearch()}}}},mt=ut,gt=(a("ce96"),Object(c["a"])(mt,ct,dt,!1,null,"99ae4a10",null)),pt=gt.exports,ht=function(){var t=this,e=t._self._c;return e("div",{staticClass:"settings-page"},[e("h2",{staticClass:"mb-4"},[t._v("用户设置")]),t.hasError?e("b-alert",{attrs:{show:"",variant:"danger"}},[t._v(t._s(t.errorMessage))]):t._e(),t.saveSuccess?e("b-alert",{attrs:{show:"",variant:"success"}},[t._v("设置已成功保存！")]):t._e(),e("b-card",{staticClass:"mb-4",scopedSlots:t._u([{key:"header",fn:function(){return[e("h5",[t._v("通用设置")])]},proxy:!0}])},[e("b-card-body",[e("b-form",{on:{submit:function(e){return e.preventDefault(),t.saveSettings.apply(null,arguments)}}},[e("b-form-group",{attrs:{label:"默认视图:","label-for":"default-view"}},[e("b-form-radio-group",{attrs:{id:"default-view",options:[{text:"网格视图",value:"grid"},{text:"列表视图",value:"list"}],stacked:""},model:{value:t.settings.defaultView,callback:function(e){t.$set(t.settings,"defaultView",e)},expression:"settings.defaultView"}})],1),e("b-form-group",{attrs:{label:"每页显示数量:","label-for":"items-per-page"}},[e("b-form-select",{attrs:{id:"items-per-page",options:[10,20,50,100]},model:{value:t.settings.itemsPerPage,callback:function(e){t.$set(t.settings,"itemsPerPage",e)},expression:"settings.itemsPerPage"}})],1),e("div",{staticClass:"d-flex justify-content-end"},[e("b-button",{attrs:{type:"submit",variant:"primary",disabled:t.isLoading}},[t.isLoading?e("b-spinner",{attrs:{small:"",type:"grow"}}):t._e(),t._v(" 保存设置 ")],1)],1)],1)],1)],1),e("b-card",{staticClass:"mt-4 mb-4",scopedSlots:t._u([{key:"header",fn:function(){return[e("div",{staticClass:"d-flex justify-content-between align-items-center"},[e("h5",{staticClass:"mb-0"},[t._v("Telegram账户管理")]),e("b-button",{attrs:{size:"sm",variant:"success"},on:{click:t.showAddAccountModal}},[e("i",{staticClass:"bi bi-plus-circle me-1"}),t._v(" 添加账户 ")])],1)]},proxy:!0}])},[e("b-card-body",[0===t.telegramAccounts.length?e("b-alert",{attrs:{show:"",variant:"info"}},[e("i",{staticClass:"bi bi-info-circle me-1"}),t._v(" 暂无Telegram账户，请添加您的第一个账户。 ")]):e("b-list-group",t._l(t.telegramAccounts,(function(a){return e("b-list-group-item",{key:a.id,staticClass:"d-flex justify-content-between align-items-center",class:{"border-primary":a.isActive,"account-item":!0}},[e("div",[e("h6",[t._v(t._s(a.name||`账户 ${a.id.substring(0,8)}...`)+" "),a.isActive?e("b-badge",{staticClass:"ms-2",attrs:{variant:"primary"}},[t._v("活跃")]):t._e()],1),e("p",{staticClass:"text-muted mb-0 small"},[t._v(" @"+t._s(a.username||"N/A")+" (ID: "+t._s(a.telegramId||"N/A")+")"),e("br"),t._v(" 上次同步: "+t._s(t._f("$_formatDate")(a.lastSync,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}))+" ")])]),e("div",{staticClass:"d-flex gap-2"},[a.isActive?t._e():e("b-button",{attrs:{size:"sm",variant:"outline-primary",disabled:t.isLoading},on:{click:function(e){return t.switchActiveAccount(a.id)}}},[t._v(" 切换活跃 ")]),e("b-button",{attrs:{size:"sm",variant:"outline-danger"},on:{click:function(e){return t.confirmDeleteAccount(a)}}},[e("i",{staticClass:"bi bi-trash"}),t._v(" 删除 ")])],1)])})),1)],1)],1),e("b-card",{staticClass:"mt-4 mb-4",scopedSlots:t._u([{key:"header",fn:function(){return[e("h5",[t._v("收藏同步")])]},proxy:!0}])},[e("b-card-body",["active"===t.sessionStatus?e("p",{staticClass:"text-success mb-2"},[e("i",{staticClass:"bi bi-check-circle me-2"}),t._v(" 您的Telegram会话已连接，收藏内容将自动同步。 ")]):"error"===t.sessionStatus?e("p",{staticClass:"text-danger mb-2"},[e("i",{staticClass:"bi bi-exclamation-triangle me-2"}),t._v(" 会话连接错误: "+t._s(t.sessionError)+" ")]):e("p",{staticClass:"text-warning mb-2"},[e("i",{staticClass:"bi bi-info-circle me-2"}),t._v(' 您尚未连接Telegram会话，请在"添加账户"时提供完整的Telegram凭证。 ')]),e("b-button",{attrs:{variant:"outline-primary",disabled:t.syncLoading||!t.hasActiveAccount},on:{click:t.syncFavorites}},[t.syncLoading?e("b-spinner",{attrs:{small:"",type:"grow"}}):t._e(),t._v(" 手动同步收藏 ")],1),t.lastSyncTime?e("small",{staticClass:"text-muted ms-3"},[t._v(" 上次同步: "+t._s(t._f("$_formatDate")(t.lastSyncTime,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}))+" ")]):t._e()],1)],1),t.activeAccount?e("b-card",{staticClass:"mt-4 mb-4",scopedSlots:t._u([{key:"header",fn:function(){return[e("h5",[t._v("用户信息")])]},proxy:!0}],null,!1,3637070169)},[e("b-card-body",[e("b-row",{attrs:{"align-v":"center"}},[e("b-col",{attrs:{md:"2",cols:"4"}},[e("b-img",{attrs:{src:t.activeAccount.profilePhoto||t.defaultAvatar,rounded:"circle",fluid:"",alt:"用户头像"}})],1),e("b-col",{attrs:{md:"10",cols:"8"}},[e("h5",[t._v(t._s(t.activeAccount.firstName||"N/A")+" "+t._s(t.activeAccount.lastName||"N/A"))]),e("p",{staticClass:"text-muted"},[t._v("@"+t._s(t.activeAccount.username||"N/A"))]),e("p",{staticClass:"mb-0"},[e("strong",[t._v("Telegram ID:")]),t._v(" "+t._s(t.activeAccount.telegramId||"N/A"))]),e("p",{staticClass:"mb-0"},[e("strong",[t._v("注册时间:")]),t._v(" "+t._s(t._f("$_formatDate")(t.user.createdAt)))]),e("p",{staticClass:"mb-0"},[e("strong",[t._v("最后登录:")]),t._v(" "+t._s(t._f("$_formatDate")(t.user.lastLogin)))])])],1)],1)],1):e("b-card",{staticClass:"mt-4 mb-4",scopedSlots:t._u([{key:"header",fn:function(){return[e("h5",[t._v("用户信息")])]},proxy:!0}])},[e("b-card-body",[e("p",{staticClass:"text-muted"},[t._v("请添加并激活您的Telegram账户，以查看您的用户信息。")])])],1),e("b-card",{staticClass:"mt-4 mb-4",scopedSlots:t._u([{key:"header",fn:function(){return[e("h5",[t._v("账户操作")])]},proxy:!0}])},[e("b-card-body",[e("b-button",{attrs:{variant:"danger"},on:{click:t.confirmLogout}},[e("i",{staticClass:"bi bi-box-arrow-right me-1"}),t._v(" 退出登录 ")])],1)],1),e("b-modal",{attrs:{id:"add-account-modal",title:t.isEditingAccount?"编辑Telegram账户":"添加Telegram账户","ok-disabled":!t.isAddAccountFormValid,"ok-title":t.isEditingAccount?"保存":"添加"},on:{ok:t.handleAddAccountSubmit,hidden:t.resetAddAccountForm},model:{value:t.showAddAccountModalForm,callback:function(e){t.showAddAccountModalForm=e},expression:"showAddAccountModalForm"}},[e("b-form",[e("b-form-group",{attrs:{label:"账户名称 (可选):","label-for":"modal-account-name"}},[e("b-form-input",{attrs:{id:"modal-account-name",placeholder:"例如：个人账户"},model:{value:t.addAccountForm.name,callback:function(e){t.$set(t.addAccountForm,"name",e)},expression:"addAccountForm.name"}})],1),e("b-form-group",{attrs:{label:"API ID:","label-for":"modal-api-id"}},[e("b-form-input",{attrs:{id:"modal-api-id",required:""},model:{value:t.addAccountForm.apiId,callback:function(e){t.$set(t.addAccountForm,"apiId",e)},expression:"addAccountForm.apiId"}}),e("div",{staticClass:"form-text"},[t._v("从 "),e("a",{attrs:{href:"https://my.telegram.org/apps",target:"_blank"}},[t._v("my.telegram.org/apps")]),t._v(" 获取")])],1),e("b-form-group",{attrs:{label:"API Hash:","label-for":"modal-api-hash"}},[e("b-form-input",{attrs:{id:"modal-api-hash",required:""},model:{value:t.addAccountForm.apiHash,callback:function(e){t.$set(t.addAccountForm,"apiHash",e)},expression:"addAccountForm.apiHash"}})],1),e("b-form-group",{attrs:{label:"SESSION_STRING:","label-for":"modal-session-string"}},[e("b-form-textarea",{attrs:{id:"modal-session-string",rows:"3",required:""},model:{value:t.addAccountForm.sessionString,callback:function(e){t.$set(t.addAccountForm,"sessionString",e)},expression:"addAccountForm.sessionString"}}),e("div",{staticClass:"form-text"},[t._v(" 使用Telegram客户端生成的会话字符串 "),e("a",{attrs:{href:"#"},on:{click:function(e){e.preventDefault(),t.showSessionHelp=!0}}},[t._v("如何获取SESSION_STRING?")])])],1)],1)],1),e("b-modal",{attrs:{id:"session-help-modal",title:"如何获取SESSION_STRING","ok-only":""},model:{value:t.showSessionHelp,callback:function(e){t.showSessionHelp=e},expression:"showSessionHelp"}},[e("div",[e("p",[t._v("获取Telegram SESSION_STRING的步骤：")]),e("ol",[e("li",[t._v("安装Python 3.8+")]),e("li",[t._v("安装Telethon库: "),e("code",[t._v("pip install telethon")])]),e("li",[t._v("创建并运行以下Python脚本：")])]),e("pre",[e("code",[t._v('from telethon.sync import TelegramClient\nfrom telethon.sessions import StringSession\n\nAPI_ID = "您的API_ID"\nAPI_HASH = "您的API_HASH"\n\nwith TelegramClient(StringSession(), API_ID, API_HASH) as client:\n    print("请登录您的Telegram账号...")\n    client.start()\n    session_string = client.session.save()\n    print(f"您的SESSION_STRING: {session_string}")')])]),e("p",[t._v("运行脚本后，按照提示登录您的Telegram账号，然后复制生成的SESSION_STRING。")]),e("p",{staticClass:"text-danger"},[t._v("注意：SESSION_STRING包含敏感信息，请勿与他人分享。")])])]),e("b-modal",{attrs:{id:"delete-account-modal",title:"确认删除账户","ok-variant":"danger","ok-title":"删除"},on:{ok:t.deleteAccount}},[e("p",[t._v('确定要删除账户 "'+t._s(t.accountToDelete?t.accountToDelete.name:"")+'" 吗？')]),e("p",{staticClass:"text-danger"},[t._v("删除账户后，您将无法查看和同步与此账户相关的收藏内容。")])]),e("b-modal",{attrs:{id:"logout-modal",title:"确认退出","ok-variant":"danger","ok-title":"退出"},on:{ok:t.logout}},[e("p",[t._v("确定要退出登录吗？")])])],1)},vt=[],bt={name:"Settings",data(){return{saveSuccess:!1,showSessionHelp:!1,showAddAccountModalForm:!1,isEditingAccount:!1,accountToDelete:null,settings:{defaultView:"grid",itemsPerPage:20},addAccountForm:{id:null,name:"",apiId:"",apiHash:"",sessionString:""},defaultAvatar:a("889b")}},computed:{...Object(o["c"])("auth",["currentUser","isLoading","hasError","errorMessage","telegramAccounts","activeAccount","hasActiveAccount","syncLoading","lastSyncTime"]),user:{get(){return this.currentUser},set(){}},isAddAccountFormValid(){const{apiId:t,apiHash:e,sessionString:a}=this.addAccountForm;return t&&e&&a}},methods:{...Object(o["b"])("auth",["updateUserSettings","logout","addTelegramAccount","switchTelegramAccount","updateTelegramAccount","deleteTelegramAccount","syncFavorites"]),async saveSettings(){try{await this.updateUserSettings(this.settings),this.saveSuccess=!0,setTimeout(()=>{this.saveSuccess=!1},3e3)}catch(t){console.error("保存设置失败:",t),this.$bvToast.toast(this.errorMessage||"保存设置失败，请重试",{title:"错误",variant:"danger",solid:!0})}},showAddAccountModal(){this.isEditingAccount=!1,this.resetAddAccountForm(),this.showAddAccountModalForm=!0},showEditAccountModal(t){this.isEditingAccount=!0,this.addAccountForm={id:t.id,name:t.name,apiId:"",apiHash:"",sessionString:""},this.showAddAccountModalForm=!0},async handleAddAccountSubmit(t){if(t.preventDefault(),this.isAddAccountFormValid)try{const t={name:this.addAccountForm.name.trim()||void 0,apiId:this.addAccountForm.apiId.trim(),apiHash:this.addAccountForm.apiHash.trim(),sessionString:this.addAccountForm.sessionString.trim()};this.isEditingAccount?(await this.updateTelegramAccount({accountId:this.addAccountForm.id,updateData:t}),this.$bvToast.toast("账户信息已更新",{title:"成功",variant:"success",solid:!0})):(await this.addTelegramAccount(t),this.$bvToast.toast("Telegram账户已添加",{title:"成功",variant:"success",solid:!0})),this.showAddAccountModalForm=!1}catch(e){this.$bvToast.toast(this.errorMessage||"操作失败，请重试",{title:"错误",variant:"danger",solid:!0})}else this.$bvToast.toast("请填写所有必填的API凭证字段",{title:"验证失败",variant:"warning",solid:!0})},resetAddAccountForm(){this.addAccountForm={id:null,name:"",apiId:"",apiHash:"",sessionString:""},this.isEditingAccount=!1},async switchActiveAccount(t){try{await this.switchTelegramAccount(t),this.$bvToast.toast("活跃账户已切换",{title:"成功",variant:"success",solid:!0})}catch(e){this.$bvToast.toast(this.errorMessage||"切换账户失败，请重试",{title:"错误",variant:"danger",solid:!0})}},confirmDeleteAccount(t){this.accountToDelete=t,this.$bvModal.show("delete-account-modal")},async deleteAccount(){if(this.accountToDelete)try{await this.deleteTelegramAccount(this.accountToDelete.id),this.$bvToast.toast("账户已删除",{title:"成功",variant:"success",solid:!0})}catch(t){this.$bvToast.toast(this.errorMessage||"删除账户失败，请重试",{title:"错误",variant:"danger",solid:!0})}finally{this.accountToDelete=null}},confirmLogout(){this.$bvModal.show("logout-modal")},formatDate(t){return this.$_formatDate(t)}},async created(){if(this.isAuthenticated)try{await this.fetchCurrentUser(),this.user&&this.user.settings&&(this.settings={...this.user.settings})}catch(t){console.error("加载用户设置和账户失败:",t)}}},ft=bt,_t=(a("adbe"),Object(c["a"])(ft,ht,vt,!1,null,"7556bf64",null)),yt=_t.exports,Tt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"not-found-page text-center"},[e("div",{staticClass:"error-container"},[e("h1",{staticClass:"display-1"},[t._v("404")]),e("h2",{staticClass:"mb-4"},[t._v("页面未找到")]),e("p",{staticClass:"lead mb-4"},[t._v("您访问的页面不存在或已被移除。")]),e("router-link",{staticClass:"btn btn-primary btn-lg",attrs:{to:"/"}},[e("i",{staticClass:"bi bi-house-door me-2"}),t._v(" 返回首页 ")])],1)])},St=[],At={name:"NotFound"},Et=At,Ct=(a("e1d7"),Object(c["a"])(Et,Tt,St,!1,null,"2970eddd",null)),wt=Ct.exports;s["default"].use(m["a"]);const Ot=[{path:"/",name:"Home",component:M},{path:"/login",name:"Login",component:V,meta:{guestOnly:!0}},{path:"/favorites",name:"Favorites",component:J,meta:{requiresAuth:!0}},{path:"/favorites/:id",name:"FavoriteDetail",component:at,meta:{requiresAuth:!0}},{path:"/tags",name:"Tags",component:lt,meta:{requiresAuth:!0}},{path:"/search",name:"Search",component:pt,meta:{requiresAuth:!0}},{path:"/settings",name:"Settings",component:yt,meta:{requiresAuth:!0}},{path:"*",name:"NotFound",component:wt}],It=new m["a"]({mode:"history",base:"/",routes:Ot});It.beforeEach(async(t,e,a)=>{if(!k.getters["auth/isAuthenticated"]&&localStorage.getItem("token"))try{await k.dispatch("auth/initializeAuth")}catch(r){return console.error("初始化认证失败:",r),k.dispatch("auth/logout"),a({path:"/login",query:{redirect:t.fullPath}})}const s=k.getters["auth/isAuthenticated"];if(t.matched.some(t=>t.meta.requiresAuth))s?a():a({path:"/login",query:{redirect:t.fullPath}});else if(t.matched.some(t=>t.meta.guestOnly))if(s){const e=t.query.redirect||"/favorites";a({path:e,replace:!0})}else a();else a()});var xt=It,Ft=a("5f5b"),Rt=a("b1e0");a("f9e3"),a("2dd8"),a("cd74");s["default"].use(Ft["a"]),s["default"].use(Rt["a"]),s["default"].config.productionTip=!1,new s["default"]({router:xt,store:k,render:t=>t(u)}).$mount("#app")},6850:function(t,e,a){},"754b":function(t,e,a){"use strict";a("acbe")},"889b":function(t,e,a){t.exports=a.p+"img/default-avatar.f54ffbc1.png"},9871:function(t,e,a){"use strict";a("6850")},a25c:function(t,e,a){},ac4b:function(t,e,a){},acbe:function(t,e,a){},adbe:function(t,e,a){"use strict";a("08e9")},ce96:function(t,e,a){"use strict";a("a25c")},deac:function(t,e,a){t.exports=a.p+"img/video-placeholder.1ca0faa7.jpg"},e1d7:function(t,e,a){"use strict";a("076f")},e4a0:function(t,e,a){t.exports=a.p+"img/image-placeholder.478229a4.jpg"},e5f2:function(t,e,a){"use strict";a("2cd6")}});
//# sourceMappingURL=app.956d1e05.js.map